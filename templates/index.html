<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Vid Vibe - YouTube Teacher Bot</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <button id="dark-mode-toggle" class="dark-mode-toggle" aria-label="Toggle dark mode">
        <span class="toggle-icon">üåô</span>
    </button>

    <div class="app-container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <h1 class="app-title">üéì Vid Vibe</h1>
            </div>

            <!-- YouTube URL Form -->
            <form method="post" class="url-form">
                <div class="form-group">
                    <label for="youtube_url" class="form-label">Paste YouTube Link Here</label>
                    <input type="text" name="youtube_url" id="youtube_url" class="form-input" 
                           placeholder="https://youtube.com/watch?v=..." required>
                </div>
                <button type="submit" class="btn btn-primary">Get Transcript</button>
                <div class="spinner" id="transcript-spinner" style="display:none;">
                    <div class="spinner-circle"></div>
                </div>
            </form>

            <!-- Summary Section -->
            {% if summary %}
            <div class="content-section summary-section">
                <h3 class="section-title">Summary</h3>
                <div class="summary-content">
                    <p class="summary-text">{{ summary|safe }}</p>
                </div>
                
                <!-- Audio Player -->
                <div class="audio-section">
                    <audio controls class="audio-player">
                        <source src="/audio" type="audio/mpeg">
                        Your browser does not support the audio element.
                    </audio>
                    <a href="/download-audio" class="btn btn-secondary btn-small">Download Audio</a>
                </div>
            </div>
            {% endif %}

            <!-- Transcript Section -->
            {% if transcript %}
            <div class="content-section transcript-section">
                <h3 class="section-title">Transcript</h3>
                <div class="transcript-content">
                    <pre class="transcript-text">{{ transcript[:500] }}{% if transcript|length > 500 %}...{% endif %}</pre>
                </div>
                <a href="/download" class="btn btn-secondary btn-small">Download Transcript</a>
            </div>
            {% endif %}
        </aside>

        <main class="main-content">
            <!-- Q&A History -->
            <div class="qa-history">
                <h2 class="qa-history-title">Questions & Answers</h2>
                <div class="qa-history-content">
                    {% if qa_history %}
                        {% for qa in qa_history %}
                        <div class="qa-item">
                            <div class="qa-question">
                                <strong>Q:</strong> {{ qa.question }}
                            </div>
                            <div class="qa-answer">
                                <strong>A:</strong> {{ qa.answer|safe }}
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <div class="qa-placeholder">
                            No questions asked yet. Generate a transcript first, then ask questions about the video content.
                        </div>
                    {% endif %}
                </div>
            </div>

            <!-- Question Input Section -->
            <div class="question-section">
                <form method="post" class="question-form">
                    <div class="question-input-row">
                        <div class="form-group flex-grow">
                            <label for="question" class="form-label">Type Question Here</label>
                            <textarea name="question" id="question" class="form-textarea" 
                                    placeholder="What is explained in this video?" rows="3" required></textarea>
                        </div>
                        <div class="clear-button-container">
                            <button type="submit" name="clear_all" class="btn btn-secondary">Clear All</button>
                        </div>
                    </div>
                    
                    <div class="question-controls">
                        <div class="form-group">
                            <label for="model" class="form-label">Select Model</label>
                            <select name="model" id="model" class="form-select">
                                <option value="gpt-3.5-turbo" {% if selected_model == 'gpt-3.5-turbo' %}selected{% endif %}>
                                    GPT-3.5 (Fast, Cheaper)
                                </option>
                                <option value="gpt-4" {% if selected_model == 'gpt-4' %}selected{% endif %}>
                                    GPT-4 (More Accurate)
                                </option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-primary">Ask</button>
                    </div>
                    
                    <div class="spinner" id="question-spinner" style="display:none;">
                        <div class="spinner-circle"></div>
                    </div>
                </form>
            </div>
        </main>
    </div>

    <!-- Toast Container -->
    <div id="toast-container" class="toast-container"></div>

    <!-- Error Messages -->
    {% if error_message %}
    <div class="error-overlay">
        <div class="error-message">
            <span class="error-icon">‚ö†Ô∏è</span>
            <span class="error-text">{{ error_message }}</span>
            <button class="error-close" onclick="this.parentElement.parentElement.style.display='none'">&times;</button>
        </div>
    </div>
    {% endif %}

    <script>
        // Dark mode toggle functionality
        const darkModeToggle = document.getElementById('dark-mode-toggle');
        const toggleIcon = darkModeToggle.querySelector('.toggle-icon');
        
        // Check for saved theme preference or default to light mode
        const savedTheme = localStorage.getItem('theme');
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        
        function setTheme(theme) {
            if (theme === 'dark') {
                document.body.classList.add('dark-mode');
                toggleIcon.textContent = '‚òÄÔ∏è';
                localStorage.setItem('theme', 'dark');
            } else {
                document.body.classList.remove('dark-mode');
                toggleIcon.textContent = 'üåô';
                localStorage.setItem('theme', 'light');
            }
        }
        
        // Initialize theme
        if (savedTheme) {
            setTheme(savedTheme);
        } else if (prefersDark) {
            setTheme('dark');
        } else {
            setTheme('light');
        }
        
        // Toggle theme on button click
        darkModeToggle.addEventListener('click', () => {
            const currentTheme = document.body.classList.contains('dark-mode') ? 'dark' : 'light';
            setTheme(currentTheme === 'dark' ? 'light' : 'dark');
        });

        // Form submission handling
        const forms = document.querySelectorAll('form');
        forms.forEach(form => {
            form.addEventListener('submit', function() {
                const spinner = this.querySelector('.spinner');
                if (spinner) {
                    spinner.style.display = 'block';
                }
            });
        });

        // Auto-resize textarea
        const textarea = document.getElementById('question');
        if (textarea) {
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = this.scrollHeight + 'px';
            });
        }

        // Toast notification system
        function showToast(message, type = 'success') {
            const toastContainer = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.innerHTML = `
                ${message}
                <button class="toast-close" onclick="this.parentElement.remove()">&times;</button>
            `;
            toastContainer.appendChild(toast);
            
            setTimeout(() => {
                if (toast.parentElement) {
                    toast.remove();
                }
            }, 5000);
        }

        // Show success/error toasts
        {% if answer and not error_message %}
        showToast('Question answered successfully!', 'success');
        {% endif %}
        
        {% if error_message %}
        showToast('{{ error_message|escape }}', 'error');
        {% endif %}
    </script>
</body>
</html>